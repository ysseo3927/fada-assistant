<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src="./resources/vendor/jquery/jquery.min.js"></script>
    
    <script src="./resources/vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="./resources/vendor/jquery-easing/jquery.easing.min.js"></script>

    <script type="text/javascript" src="./resources/vendor/html2canvas/html2canvas.js"></script>

    <script src="./resources/vendor/chart.js/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <script src="./resources/vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>

    <script src="./resources/vendor/sqljs/sql.js"></script>

    <script src="./resources/js/refer-data.js"></script>

    <link rel="stylesheet" type="text/css" href="./resources/vendor/bootstrap/css/bootstrap.min.css"></link>
    <link rel="stylesheet" type="text/css" href="./resources/vendor/fontawesome-free/css/all.min.css"></link>
    <style>

        label {
            display: inline-block;
            margin: 0 0 -1px;
            padding: 15px 25px;
            font-weight: 600;
            text-align: center;
            color: #bbb;
            border: 1px solid transparent;}

        label:hover {
            color: #000000;
            cursor: pointer;
        }

        #listCon::-webkit-scrollbar {
                width: 5px;
            }

        #listCon::-webkit-scrollbar-thumb {
            background-color: rgb(100, 100, 100);
        }

        #listCon::-webkit-scrollbar-track {
            background-color: rgb(224, 224, 224);
        }

        #dimScreen {
            width: 100%;
            height: 100%;
            background:rgba(255,255,255,0.5);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
        }

    </style>
</head>
<body style="font-family:'Malgun Gothic';">
    <div id="dimScreen" style="background-color: rgba(0, 0, 0, 0.5);text-align: center;width:100%"><div style="margin-top:400px;text-align:center;"><img style="background-color: rgb(255, 255, 255,0.8);border-radius:10px 10px 10px 10px;" src="./resources/img/loading.gif"></img></div></div>
    <div id="wrap" style="margin: auto;width:80%;">
        <div id="header-wrap">
            <div id="title-left" style="float:left;height:70px;width:60%;margin-bottom:5px;">
                <img src="./resources/img/fada_logo_.png" alt="Fada Assistant">
            </div>
            <div id="header-right" style="float:left;height:50px;width:40%;text-align:right;">
                <label class="m-0 font-weight-bold">
                    <a href="#" data-toggle="modal" onclick="showInfo();" data-target="#info-modal">Fada Assistant v1.0.1</a>
                </label>
            </div>
        </div>

        <div id="file-content">
            <input id="fileInput" filestyle="" type="file" onchange="upload(event);" accept=".xlsx" data-class-button="btn btn-default" data-class-input="form-control" data-button-text="" data-icon-name="fa fa-upload" class="form-control" tabindex="-1" style="position: fixed; clip: rect(0px 0px 0px 0px);">
            <div class="bootstrap-filestyle input-group">
                <input type="text" id="userfile" class="form-control" name="userfile" disabled="" >
                <span class="group-span-filestyle input-group-btn" tabindex="0">
                    <label for="fileInput" class="btn btn-secondary"  style="border-top-left-radius:0;border-bottom-left-radius:0;text-shadow: 0 0 3px rgb(255, 255, 228);">파일 업로드
                        <span class="glyphicon fa fa-upload"></span>
                    </label>
                </span>
            </div>
        </div>
        <hr>

        <div id="tab-content" style="padding:10px;border:1px solid rgb(211, 211, 211);">
            <div  style="width:75%;display: inline-block">
                <ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="dashboard-tab" data-toggle="tab" href="#tab1" style="border-top-left-radius:0;border-top-right-radius:0;font-weight: bold;" aria-selected="true">전체</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="chart1-tab" data-toggle="tab" href="#tab2" style="border-top-left-radius:0;border-top-right-radius:0;font-weight: bold;" aria-selected="false">업체별 합격 수량 비율</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="chart2-tab" data-toggle="tab" href="#tab3" style="border-top-left-radius:0;border-top-right-radius:0;font-weight: bold;" aria-selected="false">기간별/업체별 합격 수량</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="chart3-tab" data-toggle="tab" href="#tab4" style="border-top-left-radius:0;border-top-right-radius:0;font-weight: bold;" aria-selected="false">기간별/업체별 품목 증가 추이</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" id="chart4-tab" data-toggle="tab" href="#tab5" style="border-top-left-radius:0;border-top-right-radius:0;font-weight: bold;" aria-selected="false">기간별 합격 수량 증감 추이/건물 착공 데이터 비교</a>
                    </li>
                </ul>
            </div>
            <div style="width:24%;display: inline-block;text-align:right">
                <a id="screenshot" onclick="screenshot();" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" style="height:33px;margin-top:5px;margin-left:10px;display:block;margin-bottom:10px">
                <i class="fas fa-download fa-sm text-white-50"></i>이미지 보기</a>
            </div>
            <div class="tab-content" id="tabContent" style="border:1px solid rgb(211, 211, 211);padding-top:10px;padding-left:10px;padding-right:10px;">
                <div class="tab-pane fade show active" id="tab1">

                    <div class="row" >

                        <div style="width:50%;">
                            <div class="card shadow mb-4" style="border-radius:0px;">

                                <div
                                        class="card-header d-flex flex-row align-items-center justify-content-between">
                                    <img src="./resources/img/header1.png">
                                </div>
                                <div class="card-body" style="text-align: center;margin:auto;width:100%">
                                    <div style="width:45%;text-align: left;float:left;height:300px">
                                        <div id="legend-div-chart1"></div>
                                    </div>
                                    <div style="float:left;width:55%;position:relative;height:300px">
                                        <canvas id="chart1"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="width:50%;">
                            <div class="card shadow mb-4" style="border-radius:0px;">
                                <div class="card-header d-flex flex-row align-items-center justify-conte\nt-between">
                                        <img src="./resources/img/header2.png">
                                </div>
                                <div class="card-body" style="text-align: center;margin:auto;width:100%">
                                    <div style="width:30%;text-align: left;float:left;height:300px">
                                        <div id="legend-div-chart2"></div>
                                    </div>
                                    <div style="float:left;width:70%;position:relative;height:300px">
                                        <canvas id="chart2"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">

                        <div style="width:50%;">
                            <div class="card shadow mb-4" style="border-radius:0px;">

                                <div
                                        class="card-header d-flex flex-row align-items-center justify-content-between">
                                        <img src="./resources/img/header3.png">
                                    <div class="dropdown no-arrow"></div>
                                </div>

                                <div class="card-body" style="text-align: center;margin:auto;width:100%">
                                    <div style="width:30%;text-align: left;float:left;height:300px">
                                        <div id="legend-div-chart3"></div>
                                    </div>
                                    <div style="float:left;width:70%;position:relative;height:300px">
                                        <canvas id="chart3"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="width:50%;">
                            <div class="card shadow mb-4" style="border-radius:0px;">
                                <div
                                        class="card-header d-flex flex-row align-items-center justify-content-between">
                                        <img src="./resources/img/header4.png">
                                    <div class="dropdown no-arrow"></div>
                                </div>
                                <div class="card-body" style="text-align: center;margin:auto;width:100%">
                                    <div style="width:20%;text-align: left;float:left;height:300px">
                                        <div id="legend-div-chart4"></div>
                                    </div>
                                    <div style="float:left;width:80%;position:relative;height:300px">
                                        <canvas id="chart4"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="tab-pane fade" id="tab2">
                    <div style="margin:auto;">
                        <table style="width:100%">
                            <tr>
                                <td colspan="2">
                                    <div id="chart1_condition">
                                        년도
                                        <select id="chart1year" name="chart1year" type="text" style="width:100px;height:30px;border:1px solid #babfc7;">
                                        </select>
                                        <a id="chart1Search" onclick="chart1Search();" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" style="height:33px;margin-top:5px;margin-left:10px;display:block;margin-bottom:10px">
                                        <i class="fas fa-download fa-search text-white-50"></i>조회</a>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:35%" valign="top"><div id="legend-div-chart1-origin"></div></td>
                                <td style="width:65%">
                                    <div id="chart1-detail" style="width:100%;position:relative;height:600px">
                                        <canvas id="chart1Origin"></canvas>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="tab-pane fade" id="tab3">
                    <div style="margin:auto;">
                        <table style="width:100%">
                            <tr>
                                <td colspan="2">
                                    <div id="chart2_condition">
                                        기간(년월)
                                        <select id="chart2StartYearMonth" name="chart2StartYearMonth" type="text" style="width:100px;height:30px;border:1px solid #babfc7;">
                                        </select>
                                        ~
                                        <select id="chart2EndYearMonth" name="chart2EndYearMonth" type="text" style="width:100px;height:30px;border:1px solid #babfc7;">
                                        </select>
                                        <a id="chart2Search" onclick="chart2Search();" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" style="height:33px;margin-top:5px;margin-left:10px;display:block;margin-bottom:10px">
                                        <i class="fas fa-download fa-search text-white-50"></i>조회</a>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:20%;" valign="top">
                                    <div id="legend-div-chart2-origin" ></div>
                                </td>
                                <td style="width:80%">
                                    <div id="chart2-detail" style="width:100%;position:relative;height:600px">
                                        <canvas id="chart2Origin"></canvas>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="tab-pane fade" id="tab4">
                    <div style="margin:auto;">
                        <table style="width:100%">
                            <tr>
                                <td colspan="2">
                                    <div id="chart3_condition">
                                        기간(년도)
                                        <select id="chart3StartYear" name="chart3StartYear" type="text" style="width:100px;height:30px;border:1px solid #babfc7;">
                                        </select>
                                        ~
                                        <select id="chart3EndYear" name="chart3EndYear" type="text" style="width:100px;height:30px;border:1px solid #babfc7;">
                                        </select>
                                        <a id="chart3Search" onclick="chart3Search();" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" style="height:33px;margin-top:5px;margin-left:10px;display:block;margin-bottom:10px">
                                        <i class="fas fa-download fa-search text-white-50"></i>조회</a>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:20%" valign="top"><div id="legend-div-chart3-origin"></div></td>
                                <td style="width:80%">
                                    <div id="chart3-detail" style="width:100%;position:relative;height:600px">
                                        <canvas id="chart3Origin"></canvas>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="tab-pane fade" id="tab5">
                    <div style="margin:auto;">
                        <table style="width:100%">
                            <tr>
                                <td colspan="2">
                                    <div id="chart4_condition">
                                        기간(년도)
                                        <select id="chart4StartYear" name="chart4StartYear" type="text" style="width:100px;height:30px;border:1px solid #babfc7;">
                                        </select>
                                        ~
                                        <select id="chart4EndYear" name="chart4EndYear" type="text" style="width:100px;height:30px;border:1px solid #babfc7;">
                                        </select>
                                        <a id="chart4Search" onclick="chart4Search();" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" style="height:33px;margin-top:5px;margin-left:10px;display:block;margin-bottom:10px">
                                        <i class="fas fa-download fa-search text-white-50"></i>조회</a>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:20%" valign="top"><div id="legend-div-chart4-origin"></div></td>
                                <td style="width:80%">
                                    <div id="chart4-detail" style="width:100%;position:relative;height:600px">
                                        <canvas id="chart4Origin"></canvas>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="info-modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title m-0">정보</h6>
                </div>
                <div class="modal-body">
                    <span style="font-weight: bold;"><h5>Fada Assistant</h5></span>

                    <span>Description : Assistant Tool for fire apparatus data analysis</span><br>
                    <span>Version : 1.0.1</span><br>
                    <span>Release : 2022. 10</span>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="hideInfo()" class="btn btn-primary" data-dismiss="modal">닫기</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" style="--bs-modal-width:1530px" id="viewer-modal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title m-0">이미지 보기</h6><img src="resources/img/download_description.png"></img>
                </div>
                <div class="modal-body">
                    <div id="image-container"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="hideViewer()" class="btn btn-primary" data-dismiss="modal">닫기</button>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    
    var selectedTab = "전체";

    var db = new SQL.Database();

    var bgcolorList = [
        'rgb(255, 99, 132)', 'rgb(54, 162, 235)', 'rgb(255, 205, 86)', 'rgb(75, 192, 192)', 'rgb(255, 159, 64)', 
        'DarkSalmon','LightCoral','GoldenRod','IndianRed','MediumTurquoise','MistyRose','OliveDrab','PeachPuff',
        'Peru','SaddleBrown','SeaGreen','Silver','SlateBlue','Tan','Tomato','YellowGreen','DarkSlateBlue','ForestGreen',
        'DarkViolet','DarkSlateGray','BurlyWood','Aqua','Brown','Chartreuse','Cyan','Crimson',
        'Chocolate','DarkBlue','DarkKhaki','DarkOrchid','DarkSeaGreen','DeepPink','DeepSkyBlue','Gold',
        'Indigo','Khaki','LightBlue','Lime','MediumBlue','MediumVioletRed','NavajoWhite','OrangeRed'];

    $(document).ready(function(){
    

        $("#viewer-modal").modal({
            backdrop:'static',
            keyboard:false
        })

        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            selectedTab = $(e.target).text();
        });

        db.run("CREATE TABLE _EXCEL1_ORIGIN_DATA (X1_ID, X1_DATE, X1_YEAR, X1_YEAR_MONTH, X1_COMPANY, X1_AMOUNT);");
        db.run("CREATE TABLE _YEAR_MONTH_PROCESSING_DATA (T1_ID, T1_COMPANY, T1_YEAR_MONTH, T1_AMOUNT);");

        $("#fileInput").on('change', function(){
            if(window.FileReader){
                var filename = $(this)[0].files[0].name;
                $("#userfile").val($(this)[0].files[0].path);
            } else {
                var filename = $(this).val().split('/').pop().split('\\').pop();
            }

            $("#userfile").val(filename);
        });

        $('#myTab a').on('click', function (event) {
                event.preventDefault()
                $(this).tab('show')
        });

        $('#dimScreen').hide();
    });

    function screenshot(){

        $("#image-container").empty();

        var tabname = selectedTab;

        if(selectedTab == "전체"){
            tabname = "tab1";
        }else if(selectedTab == "업체별 합격 수량 비율"){
            tabname = "tab2";
        }else if(selectedTab == "기간별/업체별 합격 수량"){
            tabname = "tab3";
        }else if(selectedTab == "기간별/업체별 품목 증가 추이"){
            tabname = "tab4";
        }else if(selectedTab == "기간별 합격 수량 증감 추이/건물 착공 데이터 비교"){
            tabname = "tab5";
        }

        $("#chart1_condition").hide();
        $("#chart2_condition").hide();
        $("#chart3_condition").hide();
        $("#chart4_condition").hide();

        html2canvas($("#"+tabname)[0],{scrollX:-210,scrollY:-220}).then((canvas) => {
            document.getElementById('image-container').appendChild(canvas);
        });

        showViewer();
        $("#chart1_condition").show();
        $("#chart2_condition").show();
        $("#chart3_condition").show();
        $("#chart4_condition").show();

    }

    function showInfo(){
        $("#info-modal").modal('show');
    }

    function hideInfo(){
         $("#info-modal").modal("hide");

    }

    function showViewer(){
        $("#viewer-modal").modal('show');
    }

    function hideViewer(){
         $("#viewer-modal").modal("hide");

    }
    
    function upload(event){
        $('#dimScreen').show();
        
        setTimeout(function() {
            excuteExcelEngine(event);
        }, 500);

    }

    function excuteExcelEngine(event){
        
        var input = event.target;
        var reader = new FileReader();
        reader.onload = function(){
            var fdata = reader.result;
            var read_buffer = XLSX.read(fdata, {type : 'binary'});
            read_buffer.SheetNames.forEach(function(sheetName){
                var rowdata =XLSX.utils.sheet_to_json(read_buffer.Sheets[sheetName]);
                setOriginData(JSON.stringify(rowdata));
            })
        };
        reader.readAsBinaryString(input.files[0]);
    }

    function setOriginData(originData){
        let parsedOriginData = JSON.parse(originData);

        if(parsedOriginData[0].일자 === undefined || parsedOriginData[0].업체명 === undefined || parsedOriginData[0].수량 === undefined){
            alert("적합한 엑셀파일이 아닌 것 같습니다.\n일자, 업체명, 수량이 등록된 엑셀 파일을 등록해주세요.");
            $('#dimScreen').hide();
            return;
        }

        db.run("DELETE FROM _EXCEL1_ORIGIN_DATA;");
        db.run("DELETE FROM _YEAR_MONTH_PROCESSING_DATA;");

        for(var i=0; i<parsedOriginData.length; i++){
            var date = parsedOriginData[i].일자;
            var year = parsedOriginData[i].일자.substr(0,4);
            var year_month = parsedOriginData[i].일자.substr(0,7);
            var company = parsedOriginData[i].업체명;
            var amount = parsedOriginData[i].수량;
            db.run("INSERT INTO _EXCEL1_ORIGIN_DATA VALUES ("+(i+1)+", '"+date+"','"+year+"','"+year_month+"','"+company+"', "+amount+")");
        }

        analysisData();
    }

    function analysisData(){
        analysisData1();
        analysisData2();
        analysisData3();
        analysisData4();
        $('#dimScreen').hide();
    }

    function analysisData1(){
        var stmt1 = db.prepare("SELECT MAX(X1_YEAR) AS max_year ,MIN(X1_YEAR) AS min_year FROM _EXCEL1_ORIGIN_DATA");
        var data1 = stmt1.getAsObject(0);
        var parsedData1 = JSON.parse(JSON.stringify(data1));
        var maxYear = parsedData1.max_year;
        var minYear = parsedData1.min_year;
        
        for(var i=maxYear; i>=minYear; i--){
            var option = $("<option value='"+i+"'>"+i+"</option>");
            $('#chart1year').append(option);
        }

        var stmt2 = db.prepare("SELECT X1_COMPANY, SUM(X1_AMOUNT) AS X1_AMOUNT FROM _EXCEL1_ORIGIN_DATA WHERE X1_YEAR = '" +maxYear+ "' GROUP BY X1_COMPANY ORDER BY X1_AMOUNT DESC");
        
        var companyMap = new Map();
        var sumAmount = 0;

        while(stmt2.step()){
            var data2 = stmt2.getAsObject();
            var parsedData2 = JSON.parse(JSON.stringify(data2));
            var company = parsedData2.X1_COMPANY;
            var amount =  parsedData2.X1_AMOUNT;
            sumAmount += parseInt(amount);
            companyMap.set(company, amount);
        }
        
        var chart1Labels = [];
        var chart1Datas = [];
        for(const key of companyMap.keys()){
            let value = companyMap.get(key);
            var fixData = parseFloat(parseFloat(value/sumAmount*100).toFixed(2));
            chart1Labels.push(key+"("+fixData+"%)");
            chart1Datas.push(value);
        }

        chart1.data.labels = chart1Labels;
        chart1.data.datasets[0].data = chart1Datas;
        chart1.data.datasets[0].backgroundColor = bgcolorList;
        chart1.update();

        chart1Search(maxYear);
    }

    function chart1Search(year){
        if(year=="" || year === undefined){
            year = $("#chart1year").val();
        }
        
        var stmt2 = db.prepare("SELECT X1_COMPANY, SUM(X1_AMOUNT) AS X1_AMOUNT FROM _EXCEL1_ORIGIN_DATA WHERE X1_YEAR = '" +year+ "' GROUP BY X1_COMPANY ORDER BY X1_AMOUNT DESC");
        
        var companyMap = new Map();
        var sumAmount = 0;

        while(stmt2.step()){
            var data2 = stmt2.getAsObject();
            var parsedData2 = JSON.parse(JSON.stringify(data2));
            var company = parsedData2.X1_COMPANY;
            var amount =  parsedData2.X1_AMOUNT;
            sumAmount += parseInt(amount);
            companyMap.set(company, amount);
        }
        
        var chart1Labels = [];
        var chart1Datas = [];
        for(const key of companyMap.keys()){
            let value = companyMap.get(key);
            var fixData = parseFloat(parseFloat(value/sumAmount*100).toFixed(2));
            chart1Labels.push(key+"("+fixData+"%)");
            chart1Datas.push(value);
        }

        chart1Origin.data.labels = chart1Labels;
        chart1Origin.data.datasets[0].data = chart1Datas;
        chart1Origin.data.datasets[0].backgroundColor = bgcolorList;
        chart1Origin.update();
    }

    function analysisData2(){
        var stmt1 = db.prepare("SELECT DISTINCT X1_YEAR_MONTH AS year_month_ FROM _EXCEL1_ORIGIN_DATA ORDER BY year_month_ DESC");

        while(stmt1.step()){
            var data1 = stmt1.getAsObject();
            var parsedData1 = JSON.parse(JSON.stringify(data1));
            var yearMonth_ = parsedData1.year_month_;
            var option1 = $("<option value='"+yearMonth_+"'>"+yearMonth_+"</option>");
            var option2 = $("<option value='"+yearMonth_+"'>"+yearMonth_+"</option>");
            $('#chart2StartYearMonth').append(option1);
            $('#chart2EndYearMonth').append(option2);
        }

        var stmt2 = db.prepare("SELECT DISTINCT X1_YEAR_MONTH FROM _EXCEL1_ORIGIN_DATA ORDER BY X1_YEAR_MONTH DESC LIMIT 12");
        var stmt3 = db.prepare("SELECT DISTINCT X1_COMPANY FROM _EXCEL1_ORIGIN_DATA");

        var i =0;

        var yearMonthList = [];
        while(stmt2.step()){
            var data2 = stmt2.getAsObject();
            var parsedData2 = JSON.parse(JSON.stringify(data2));
            var yearMonth = parsedData2.X1_YEAR_MONTH;

            yearMonthList.push(yearMonth);
        }
        yearMonthList.sort();

        $("#chart2StartYearMonth").val(yearMonthList[0]).prop("selected", true);
        $("#chart2EndYearMonth").val(yearMonthList[yearMonthList.length-1]).prop("selected", true);
        chart2Search(yearMonthList[0], yearMonthList[yearMonthList.length-1]);

        var companyList = [];
        while(stmt3.step()){
            var data3 = stmt3.getAsObject();
            var parsedData3 = JSON.parse(JSON.stringify(data3));
            var company = parsedData3.X1_COMPANY;

            companyList.push(company);
        }

        var datasets = [];
        for(var j=0; j < companyList.length; j++){
            var amountList = [];
            for(var k=0; k<yearMonthList.length; k++){
                var stmt4 = db.prepare("SELECT IFNULL(SUM(X1_AMOUNT),0) AS amount FROM _EXCEL1_ORIGIN_DATA WHERE X1_YEAR_MONTH = '"+yearMonthList[k]+"' AND X1_COMPANY = '"+companyList[j]+"'");
                var data4 = stmt4.getAsObject(0);
                var parsedData4 = JSON.parse(JSON.stringify(data4));
                var amount = parsedData4.amount;
                amountList.push(amount);
            }
            var dataset = {
                label : companyList[j],
                data : amountList,
                borderColor : bgcolorList[j],
                backgroundColor : bgcolorList[j],
                tension: 0.1
            }
            datasets.push(dataset);
        }
        
        chart2.data.labels = yearMonthList;
        chart2.data.datasets = datasets;
        chart2.update();
    }

    function chart2Search(startYearMonth, endYearMonth){
        if(startYearMonth=="" || startYearMonth === undefined || endYearMonth=="" || endYearMonth === undefined){
            startYearMonth = $("#chart2StartYearMonth").val();
            endYearMonth = $("#chart2EndYearMonth").val();
        }

        var stmt2 = db.prepare("SELECT DISTINCT X1_YEAR_MONTH FROM _EXCEL1_ORIGIN_DATA WHERE X1_YEAR_MONTH >= '"+startYearMonth+"' AND X1_YEAR_MONTH <= '"+endYearMonth+"' ORDER BY X1_YEAR_MONTH DESC");
        var stmt3 = db.prepare("SELECT DISTINCT X1_COMPANY FROM _EXCEL1_ORIGIN_DATA");

        var i =0;
        
        var yearMonthList = [];
        while(stmt2.step()){
            var data2 = stmt2.getAsObject();
            var parsedData2 = JSON.parse(JSON.stringify(data2));
            var yearMonth = parsedData2.X1_YEAR_MONTH;

            yearMonthList.push(yearMonth);
        }
        
        if(yearMonthList.length >= 24){
            alert("최대 24개월까지 조회 가능합니다.");
            return;
        }
        yearMonthList.sort();

        var companyList = [];
        while(stmt3.step()){
            var data3 = stmt3.getAsObject();
            var parsedData3 = JSON.parse(JSON.stringify(data3));
            var company = parsedData3.X1_COMPANY;

            companyList.push(company);
        }

        var datasets = [];
        for(var j=0; j < companyList.length; j++){
            var amountList = [];
            for(var k=0; k<yearMonthList.length; k++){
                var stmt4 = db.prepare("SELECT IFNULL(SUM(X1_AMOUNT),0) AS amount FROM _EXCEL1_ORIGIN_DATA WHERE X1_YEAR_MONTH = '"+yearMonthList[k]+"' AND X1_COMPANY = '"+companyList[j]+"'");
                var data4 = stmt4.getAsObject(0);
                var parsedData4 = JSON.parse(JSON.stringify(data4));
                var amount = parsedData4.amount;
                amountList.push(amount);
            }
            var dataset = {
                label : companyList[j],
                data : amountList,
                borderColor : bgcolorList[j],
                backgroundColor : bgcolorList[j],
                tension: 0.1
            }
            datasets.push(dataset);
        }
        
        chart2Origin.data.labels = yearMonthList;
        chart2Origin.data.datasets = datasets;
        chart2Origin.update();
    }

    function analysisData3(){
        var stmt1 = db.prepare("SELECT DISTINCT X1_YEAR FROM _EXCEL1_ORIGIN_DATA  ORDER BY X1_YEAR DESC");
        var yearMonthList = [];

        while(stmt1.step()){
            var data1 = stmt1.getAsObject();
            var parsedData1 = JSON.parse(JSON.stringify(data1));
            var year_ = parsedData1.X1_YEAR;

            yearMonthList.push(year_);
            var option1 = $("<option value='"+year_+"'>"+year_+"</option>");
            var option2 = $("<option value='"+year_+"'>"+year_+"</option>");
            $('#chart3StartYear').append(option1);
            $('#chart3EndYear').append(option2);
        }
        
        var stmt2 = db.prepare("SELECT DISTINCT X1_YEAR FROM _EXCEL1_ORIGIN_DATA ORDER BY X1_YEAR DESC LIMIT 10");
        var stmt3 = db.prepare("SELECT DISTINCT X1_COMPANY FROM _EXCEL1_ORIGIN_DATA");

        var i =0;

        var yearList = [];
        while(stmt2.step()){
            var data2 = stmt2.getAsObject();
            var parsedData2 = JSON.parse(JSON.stringify(data2));
            var year = parsedData2.X1_YEAR;

            yearList.push(year);
        }
        yearList.sort();

        $("#chart3StartYear").val(yearList[0]).prop("selected", true);
        $("#chart3EndYear").val(yearList[yearList.length-1]).prop("selected", true);
        chart3Search(yearList);

        var companyList = [];
        while(stmt3.step()){
            var data3 = stmt3.getAsObject();
            var parsedData3 = JSON.parse(JSON.stringify(data3));
            var company = parsedData3.X1_COMPANY;

            companyList.push(company);
        }

        var datasets = [];
        for(var j=0; j < companyList.length; j++){
            var amountList = [];
            for(var k=0; k<yearList.length; k++){
                var stmt4 = db.prepare("SELECT IFNULL(SUM(X1_AMOUNT),0) AS amount FROM _EXCEL1_ORIGIN_DATA WHERE X1_YEAR = '"+yearList[k]+"' AND X1_COMPANY = '"+companyList[j]+"'");
                var data4 = stmt4.getAsObject(0);
                var parsedData4 = JSON.parse(JSON.stringify(data4));
                var amount = parsedData4.amount;
                amountList.push(amount);
            }
            var dataset = {
                label : companyList[j],
                data : amountList,
                backgroundColor : bgcolorList[j],
            }
            datasets.push(dataset);
        }
        
        chart3.data.labels = yearList;
        chart3.data.datasets = datasets;
        chart3.update();
    }

    function chart3Search(yearList){
        
        if(yearList === undefined || yearList == null){
            startYear = $("#chart3StartYear").val();
            endYear = $("#chart3EndYear").val();

            yearList = [];

            var stmt1 = db.prepare("SELECT DISTINCT X1_YEAR FROM _EXCEL1_ORIGIN_DATA WHERE X1_YEAR >= '"+startYear+"' AND X1_YEAR <= '"+endYear+"' ORDER BY X1_YEAR DESC");

            while(stmt1.step()){
                var data1 = stmt1.getAsObject();
                var parsedData1 = JSON.parse(JSON.stringify(data1));
                var year_ = parsedData1.X1_YEAR;
                yearList.push(year_);
            }
            yearList.sort();
        }

        var stmt3 = db.prepare("SELECT DISTINCT X1_COMPANY FROM _EXCEL1_ORIGIN_DATA");

        var companyList = [];

        while(stmt3.step()){
            var data3 = stmt3.getAsObject();
            var parsedData3 = JSON.parse(JSON.stringify(data3));
            var company = parsedData3.X1_COMPANY;

            companyList.push(company);
        }

        var datasets = [];
        for(var j=0; j < companyList.length; j++){
            var amountList = [];
            for(var k=0; k<yearList.length; k++){
                var stmt4 = db.prepare("SELECT IFNULL(SUM(X1_AMOUNT),0) AS amount FROM _EXCEL1_ORIGIN_DATA WHERE X1_YEAR = '"+yearList[k]+"' AND X1_COMPANY = '"+companyList[j]+"'");
                var data4 = stmt4.getAsObject(0);
                var parsedData4 = JSON.parse(JSON.stringify(data4));
                var amount = parsedData4.amount;
                amountList.push(amount);
            }
            var dataset = {
                label : companyList[j],
                data : amountList,
                backgroundColor : bgcolorList[j],
            }
            datasets.push(dataset);
        }
        
        chart3Origin.data.labels = yearList;
        chart3Origin.data.datasets = datasets;
        chart3Origin.update();
    }

    function analysisData4(){

        var stmt1 = db.prepare("SELECT DISTINCT X1_YEAR FROM _EXCEL1_ORIGIN_DATA  ORDER BY X1_YEAR DESC");
        var yearMonthList = [];

        while(stmt1.step()){
            var data1 = stmt1.getAsObject();
            var parsedData1 = JSON.parse(JSON.stringify(data1));
            var year_ = parsedData1.X1_YEAR;

            yearMonthList.push(year_);
            var option1 = $("<option value='"+year_+"'>"+year_+"</option>");
            var option2 = $("<option value='"+year_+"'>"+year_+"</option>");
            $('#chart4StartYear').append(option1);
            $('#chart4EndYear').append(option2);
        }


        var stmt2 = db.prepare("SELECT X1_YEAR, IFNULL(SUM(X1_AMOUNT),0) AS X1_AMOUNT FROM _EXCEL1_ORIGIN_DATA GROUP BY X1_YEAR ORDER BY X1_YEAR DESC LIMIT 10");

        var dataMap = new Map();
        
        var yearList = [];
        while(stmt2.step()){ 
            var data2 = stmt2.getAsObject();
            var parsedData2 = JSON.parse(JSON.stringify(data2));
            var _year = parsedData2.X1_YEAR;
            var _amount = parsedData2.X1_AMOUNT;
            yearList.push(_year);
            dataMap.set(_year,_amount);
        }
        yearList.sort();
        
        
        $("#chart4StartYear").val(yearList[0]).prop("selected", true);
        $("#chart4EndYear").val(yearList[yearList.length-1]).prop("selected", true);
        var startYear_ = yearList[0];
        var endYear_ = yearList[yearList.length-1];
        
        var prevYear = yearList[0]-1;
        var stmt3 = db.prepare("SELECT IFNULL(SUM(X1_AMOUNT),0) AS X1_PREV_AMOUNT FROM _EXCEL1_ORIGIN_DATA WHERE X1_YEAR = '"+prevYear+"'");
        var data3 = stmt3.getAsObject(0);
        var parsedData3 = JSON.parse(JSON.stringify(data3));
        var prevAmount = parsedData3.X1_PREV_AMOUNT;

        var amountList = [];
        var buildingAreaList = [];
        var compareRateList = [];
        for(var key of yearList){
            amountList.push(dataMap.get(key));
            if(_BUILDING_AREA_DATA.has(key)){
                buildingAreaList.push(_BUILDING_AREA_DATA.get(key));
            }else{
                buildingAreaList.push(0);
            }

            var rate = 0;
            if(key-1 == prevYear){
                rate = ((dataMap.get(key)-prevAmount)/dataMap.get(key))*100;
                compareRateList.push(rate.toFixed(2));
            }else{
                rate = ((dataMap.get(key)-dataMap.get((key-1)+""))/dataMap.get(key))*100;
                compareRateList.push(rate.toFixed(2));
            }
        }

        var datasets = [];
        var dataset1 = {
            type: 'bar',
            label: '합계(개)',
            data: amountList,
            yAxisID: 'A',
            backgroundColor : 'rgb(54, 162, 235)',
            borderColor : 'rgb(54, 162, 235)',
            tension: 0.1
        }
        var dataset2 = {
            type: 'line',
            label: '전년대비(%)',
            data: compareRateList,
            yAxisID: 'B',
            backgroundColor : 'rgb(255, 99, 132)',
            borderColor : 'rgb(255, 99, 132)',
            tension: 0.1
        }
        var dataset3 = {
            type: 'line',
            label: '착공면적(천㎡)',
            data: buildingAreaList,
            backgroundColor : 'rgb(255, 205, 86)',
            borderColor : 'rgb(255, 205, 86)',
            tension: 0.1
        }
        datasets.push(dataset1);
        datasets.push(dataset2);
        datasets.push(dataset3);

        chart4.data.labels = yearList;
        chart4.data.datasets = datasets;
        chart4.update();
        setTimeout(function() {
            chart4Search(startYear_, endYear_);
        }, 500);

    }

    function chart4Search(startYear, endYear){
        
        if(startYear === undefined || startYear == null || endYear === undefined || endYear == null){
            startYear = $("#chart4StartYear").val();
            endYear = $("#chart4EndYear").val();
        }

        var stmt2 = db.prepare("SELECT X1_YEAR, IFNULL(SUM(X1_AMOUNT),0) AS X1_AMOUNT FROM _EXCEL1_ORIGIN_DATA WHERE X1_YEAR >= '"+startYear+"' AND X1_YEAR <= '"+endYear+"' GROUP BY X1_YEAR ORDER BY X1_YEAR DESC");

        var dataMap = new Map();

        var yearList = [];
        while(stmt2.step()){ 
            var data2 = stmt2.getAsObject();
            var parsedData2 = JSON.parse(JSON.stringify(data2));
            var _year = parsedData2.X1_YEAR;
            var _amount = parsedData2.X1_AMOUNT;
            yearList.push(_year);
            dataMap.set(_year,_amount);
        }
        yearList.sort();

        var prevYear = yearList[0]-1;
        var stmt3 = db.prepare("SELECT IFNULL(SUM(X1_AMOUNT),0) AS X1_PREV_AMOUNT FROM _EXCEL1_ORIGIN_DATA WHERE X1_YEAR = '"+prevYear+"'");
        var data3 = stmt3.getAsObject(0);
        var parsedData3 = JSON.parse(JSON.stringify(data3));
        var prevAmount = parsedData3.X1_PREV_AMOUNT;

        var amountList = [];
        var buildingAreaList = [];
        var compareRateList = [];
        for(var key of yearList){
            amountList.push(dataMap.get(key));
            if(_BUILDING_AREA_DATA.has(key)){
                buildingAreaList.push(_BUILDING_AREA_DATA.get(key));
            }else{
                buildingAreaList.push(0);
            }

            var rate = 0;
            if(key-1 == prevYear){
                rate = ((dataMap.get(key)-prevAmount)/dataMap.get(key))*100;
                compareRateList.push(rate.toFixed(2));
            }else{
                rate = ((dataMap.get(key)-dataMap.get((key-1)+""))/dataMap.get(key))*100;
                compareRateList.push(rate.toFixed(2));
            }
        }

        var datasets = [];

        var dataset1 = {
            type: 'bar',
            label: '합계(개)',
            data: amountList,
            yAxisID: 'A',
            backgroundColor : 'rgb(54, 162, 235)',
            borderColor : 'rgb(54, 162, 235)',
            tension: 0.1
        }
        var dataset2 = {
            type: 'line',
            label: '전년대비(%)',
            data: compareRateList,
            yAxisID: 'B',
            backgroundColor : 'rgb(255, 99, 132)',
            borderColor : 'rgb(255, 99, 132)',
            tension: 0.1
        }
        var dataset3 = {
            type: 'line',
            label: '착공면적(천㎡)',
            data: buildingAreaList,
            backgroundColor : 'rgb(255, 205, 86)',
            borderColor : 'rgb(255, 205, 86)',
            tension: 0.1
        }

        datasets.push(dataset1);
        chart4Origin.data.datasets = datasets;
        chart4Origin.update();

        datasets.push(dataset2);
        chart4Origin.data.datasets = datasets;
        chart4Origin.update();

        datasets.push(dataset3);
        chart4Origin.data.datasets = datasets;
        chart4Origin.update();

        chart4Origin.data.labels = yearList;
        chart4Origin.update();
    }
</script>
<script>

    Chart.register(ChartDataLabels);
    
    const getOrCreateLegendList = (chart, id) => {
        var widthPix = '300px';
        if(id == "legend-div-chart1-origin" || id == "legend-div-chart2-origin" || id == "legend-div-chart3-origin" || id == "legend-div-chart4-origin"){
            widthPix = '600px';
        }
        const legendContainer = document.getElementById(id);
        let listContainer = legendContainer.querySelector('ul');

        if (!listContainer) {
            listContainer = document.createElement('ul');
            listContainer.id = "listCon"
            listContainer.style.paddingLeft= '0px';
            listContainer.style.height = widthPix;
            listContainer.style.overflow = 'auto';
            listContainer.style.fontSize = '12px';
            listContainer.style.flexDirection = 'row';
            listContainer.style.margin = 0;
            listContainer.style.paddingTop = 0;

            legendContainer.appendChild(listContainer);
        }

        return listContainer;
    };

    const htmlLegendPlugin = {
        id: 'htmlLegend',
        afterUpdate(chart, args, options) {
            const ul = getOrCreateLegendList(chart, options.containerID);

            while (ul.firstChild) {
                ul.firstChild.remove();
            }

            const items = chart.options.plugins.legend.labels.generateLabels(chart);

            items.forEach(item => {
                const li = document.createElement('li');
                li.style.alignItems = 'left';
                li.style.cursor = 'pointer';
                li.style.display = 'flex';
                li.style.flexDirection = 'row';
                li.style.marginLeft = '0px';

                li.onclick = () => {
                const {type} = chart.config;
                if (type === 'pie' || type === 'doughnut') {
                    chart.toggleDataVisibility(item.index);
                } else {
                    chart.setDatasetVisibility(item.datasetIndex, !chart.isDatasetVisible(item.datasetIndex));
                }
                chart.update();
                };

                const boxSpan = document.createElement('span');
                boxSpan.style.background = item.fillStyle;
                boxSpan.style.borderColor = item.strokeStyle;
                boxSpan.style.borderWidth = item.lineWidth + 'px';
                boxSpan.style.display = 'inline-block';
                boxSpan.style.height = '17px';
                boxSpan.style.marginRight = '10px';
                boxSpan.style.marginBottom = '2px';
                boxSpan.style.width = '17px';

                const textContainer = document.createElement('p');
                textContainer.style.color = item.fontColor;
                textContainer.style.margin = 0;
                textContainer.style.padding = 0;
                textContainer.style.textDecoration = item.hidden ? 'line-through' : '';

                const text = document.createTextNode(item.text);
                textContainer.appendChild(text);

                li.appendChild(boxSpan);
                li.appendChild(textContainer);
                ul.appendChild(li);
            });
        }
    };

    var chart1 = new Chart(document.getElementById("chart1"), {
        type: 'pie',
        data: {
            labels: [
                ''
            ],
            datasets: [{
                label: '',
                data: [100],
                backgroundColor: [
                'rgb(255, 99, 132)',
                'rgb(54, 162, 235)',
                'rgb(255, 205, 86)'
                ],
                hoverOffset: 4
            }]
            },
        options: {
            layout: {
                padding: {
                    top: 30,
                    bottom:30,
                    left:30,
                    right:30
                }
            },
            title: {
                display: false
            },
            plugins: {
                legend: {
                    display: false
                },
                htmlLegend: {
                    containerID: 'legend-div-chart1',
                },
                datalabels: {
                    anchor:'end',
                    align:'end',
                    backgroundColor: function (context) {
                        return context.dataset.backgroundColor;
                    },
                    borderColor: 'white',
                    borderRadius: 3,
                    borderWidth: 0,
                    color: function (context) {
                        return context.hovered ? 'black' : 'black'
                    },
                    font: {
                        weight: 'bold'
                    },
                    listeners: {
                        enter: function (context) {
                            context.hovered = true;
                            return true;
                        },
                        leave: function (context) {
                            context.hovered = false;
                            return true;
                        }
                    },
                    display: true,
                    formatter: function (value, ctx) {
                        let datasets = ctx.chart.data.datasets[0].data;
                        if(value !=0){
                            let sum =0;
                            dataArr = ctx.chart.data.datasets[0].data;
                            dataArr.map(data => {
                                sum += parseInt(data);
                            });
                            let percentage = parseFloat(parseFloat(value*100/sum).toFixed(2))+"%";
                            return percentage;
                        }else{
                            let percentage = "";
                            return percentage;
                        }
                    }.bind(this)
                },
            },
            responsive: true,
            maintainAspectRatio: false
        },
        plugins: [htmlLegendPlugin]
    });

    var chart1Origin = new Chart(document.getElementById("chart1Origin"), {
        type: 'pie',
        data: {
            labels: [
                ''
            ],
            datasets: [{
                label: '',
                data: [100],
                backgroundColor: [
                'rgb(255, 99, 132)',
                'rgb(54, 162, 235)',
                'rgb(255, 205, 86)'
                ],
                hoverOffset: 4
            }]
            },
        options: {
            layout: {
                padding: {
                    top: 30,
                    bottom:30,
                    left:30,
                    right:30
                }
            },
            title: {
                display: false
            },
            plugins: {
                legend: {
                    display: false
                },
                htmlLegend: {
                    containerID: 'legend-div-chart1-origin',
                },
                datalabels: {
                    anchor:'end',
                    align:'end',
                    backgroundColor: function (context) {
                        return context.dataset.backgroundColor;
                    },
                    borderColor: 'white',
                    borderRadius: 3,
                    borderWidth: 0,
                    color: function (context) {
                        return context.hovered ? 'black' : 'black'
                    },
                    font: {
                        weight: 'bold'
                    },
                    listeners: {
                        enter: function (context) {
                            context.hovered = true;
                            return true;
                        },
                        leave: function (context) {
                            context.hovered = false;
                            return true;
                        }
                    },
                    display: true,
                    formatter: function (value, ctx) {
                        let datasets = ctx.chart.data.datasets[0].data;
                        if(value !=0){
                            let sum =0;
                            dataArr = ctx.chart.data.datasets[0].data;
                            dataArr.map(data => {
                                sum += parseInt(data);
                            });
                            let percentage = parseFloat(parseFloat(value*100/sum).toFixed(2))+"%";
                            return percentage;
                        }else{
                            let percentage = "";
                            return percentage;
                        }
                    }.bind(this)
                },
            },
            responsive: true,
            maintainAspectRatio: false
        },
        plugins: [htmlLegendPlugin]
    });

    var chart2 = new Chart(document.getElementById("chart2"), {
        type: 'line',
        data: {
            labels: [
                ''
            ],
            datasets: [{
                label: '',
                data: [0, 0, 0, 0, 0, 0, 0],
                fill: false,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        },
        options: {
            layout: {
            padding: {
                top: 30,
                bottom:30,
                left:30,
                right:30
                }
            },
            plugins: {
                datalabels: {
                    display: false
                },
                legend: {
                    display: false,
                },
                htmlLegend: {
                    containerID: 'legend-div-chart2',
                }
            },
            responsive: true,
            maintainAspectRatio: false
        },
        plugins: [htmlLegendPlugin]
    });

    
    var chart2Origin = new Chart(document.getElementById("chart2Origin"), {
        type: 'line',
        data: {
            labels: [
                ''
            ],
            datasets: [{
                label: '',
                data: [0, 0, 0, 0, 0, 0, 0],
                fill: false,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        },
        options: {
            scales: {
                    y: {
                        ticks: {
                          callback: function(val, index) {
                              return val;
                          },
                        }
                    }
                },
            layout: {
            padding: {
                top: 30,
                bottom:30,
                left:30,
                right:30
                }
            },
            plugins: {
                datalabels: {
                    display: false
                },
                legend: {
                    display: false,
                },
                htmlLegend: {
                    containerID: 'legend-div-chart2-origin',
                }
            },
            responsive: true,
            maintainAspectRatio: false
        },
        plugins: [htmlLegendPlugin]
    });

    var chart3 = new Chart(document.getElementById("chart3"), {
        type: 'bar',
        data: {
            labels: [
                '','','','','','','','','',''
            ],
            datasets: [{
                label: '',
                data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)'
                ],
                borderColor: [
                    'rgb(255, 99, 132)'
                ],
                borderWidth: 1
            },
            {
                label: '',
                data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)'
                ],
                borderColor: [
                    'rgb(255, 99, 132)'
                ],
                borderWidth: 1
            }
        ]
        },
        options: {
            scales: {
                    y: {
                        ticks: {
                          callback: function(val, index) {
                              return val;
                          },
                        }
                    }
                },
            layout: {
            padding: {
                top: 30,
                bottom:30,
                left:30,
                right:30
                }
            },
            plugins: {
                datalabels: {
                    display: false
                },
                legend: {
                    display: false,
                },
                htmlLegend: {
                    containerID: 'legend-div-chart3',
                }
            },
            responsive: true,
            maintainAspectRatio: false,
            barThickness: 3
        },
        plugins: [htmlLegendPlugin]
    });

    var chart3Origin = new Chart(document.getElementById("chart3Origin"), {
        type: 'bar',
        data: {
            labels: [
            '','','','','','','','','',''
            ],
            datasets: [{
                label: '',
                data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(255, 159, 64, 0.2)',
                    'rgba(255, 205, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(201, 203, 207, 0.2)'
                ],
                borderColor: [
                    'rgb(255, 99, 132)',
                    'rgb(255, 159, 64)',
                    'rgb(255, 205, 86)',
                    'rgb(75, 192, 192)',
                    'rgb(54, 162, 235)',
                    'rgb(153, 102, 255)',
                    'rgb(201, 203, 207)'
                ],
                borderWidth: 1
            },
            {
                label: '',
                data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(255, 159, 64, 0.2)',
                    'rgba(255, 205, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(201, 203, 207, 0.2)'
                ],
                borderColor: [
                    'rgb(255, 99, 132)',
                    'rgb(255, 159, 64)',
                    'rgb(255, 205, 86)',
                    'rgb(75, 192, 192)',
                    'rgb(54, 162, 235)',
                    'rgb(153, 102, 255)',
                    'rgb(201, 203, 207)'
                ],
                borderWidth: 1
            }
        ]
        },
        options: {
            scales: {
                    y: {
                        ticks: {
                          callback: function(val, index) {
                              return val;
                          },
                        }
                    }
                },
            layout: {
            padding: {
                top: 30,
                bottom:30,
                left:30,
                right:30
                }
            },
            plugins: {
                datalabels: {
                    display: false
                },
                legend: {
                    display: false,
                },
                htmlLegend: {
                    containerID: 'legend-div-chart3-origin',
                }
            },
            responsive: true,
            maintainAspectRatio: false,
            barThickness: 3
        },
        plugins: [htmlLegendPlugin]
    });

    var chart4 = new Chart(document.getElementById("chart4"), {
        type: 'line',
        data: {
            labels: ['', '', '', '', '', '', '', '', '', ''],
            datasets: [{
                type: 'bar',
                label: '',
                data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            }, {
                type: 'line',
                label: '',
                data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            }]
        },
        options: {
            layout: {
            padding: {
                top: 30,
                bottom:30,
                left:30,
                right:30
                }
            },
            plugins: {
                datalabels: {
                    display: false
                },
                legend: {
                    display: false,
                },
                htmlLegend: {
                    containerID: 'legend-div-chart4',
                }
            },
            scales: {
                A:{
                    ticks: {
                          callback: function(val, index) {
                              return val;
                          },
                        },
                        display: true,
                        type:'linear',
                        position:'right',
                    },
                B: {
                    ticks: {
                          callback: function(val, index) {
                              return val;
                          },
                        },
                        display: true,
                        type:'linear',
                        position:'left',
                        grid: { display: false }
                    }
                
            },
            responsive: true,
            maintainAspectRatio: false,
            barThickness: 10
        },
        plugins: [htmlLegendPlugin]
    });

    
    var chart4Origin = new Chart(document.getElementById("chart4Origin"), {
        type: 'line',
        data: {
            labels: [''],
            datasets: [{
                type: 'bar',
                label: '',
                data: [0]
            }, {
                type: 'line',
                label: '',
                data: [0],
            }]
        },
        options: {
            layout: {
            padding: {
                top: 30,
                bottom:30,
                left:30,
                right:30
                }
            },
            plugins: {
                datalabels: {
                    display: false
                },
                legend: {
                    display: false,
                },
                htmlLegend: {
                    containerID: 'legend-div-chart4-origin',
                }
            },
            scales: {
                A:{
                    ticks: {
                          callback: function(val, index) {
                              return val;
                          },
                        },
                        display: true,
                        type:'linear',
                        position:'right',
                    },
                B: {
                    ticks: {
                          callback: function(val, index) {
                              return val;
                          },
                        },
                        display: true,
                        type:'linear',
                        position:'left',
                        grid: { display: false }
                    }
                
            },
            responsive: true,
            maintainAspectRatio: false,
            barThickness: 10
        },
        plugins: [htmlLegendPlugin]
    });
</script>
</html>